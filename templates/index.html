<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cornell Real Estate Competition</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  </head>
  <body>
    <!-- // Note that this page is quickly generated for test -->
    <div class="container" style="margin-top: 25px; margin-bottom: 25px;">
      <h1 style="text-align:center; margin-bottom: 25px;">Rent RSF Calculator</h1>
      <div class="row" style="margin-bottom: 25px;">
        <span class="col-sm-4"></span>
        <span class="col-sm-3">
          <input type="text" id="option-input" name="option" class="form-control" style="width:100%">
        </span>
        <span class="col-sm-1">
          <button type="button" name="button" class="btn btn-primary" id="submit">Submit!</button>
        </span>
        <span class="col-sm-4"></span>
      </div>
    </div>
    <div style="margin: 30px;">
      <div id="output"></div>
    </div>
  </body>
  <script type="text/javascript">
    var button = document.getElementById("submit");
    var input = document.getElementById("option-input");
    var data = JSON.parse({{ result|tojson|safe }});
    var binaryMap = JSON.parse({{ binaryMap|tojson|safe }});
    submit.onclick = () => {
      var outputDisplay = document.getElementById("output");
      var inputUpper = input.value.toUpperCase();
      if (!data.hasOwnProperty(inputUpper)) {
        outputDisplay.innerHTML = '<p style="text-align:center">Invalid Input</p>';
        return
      }

      // Get space position
      var temp = 0, numSpace = 0;
      var spaces = [];
      while(1){
        temp = inputUpper.indexOf(' ', temp + 1)
        if (temp < 0) break;
        spaces.push(temp - numSpace);
        numSpace += 1;
      }

      var output = data[inputUpper];
      var bm = binaryMap[inputUpper];
      var string = '<table class="table"><thead class="thead-default"><tr><th>floor\\year</th>';
      for (var i = 0; i < output[0].length; i++){
        string = string + "<th>" + (2016 + i).toString() + "</th>"
      }
      string = string + "</tr></thead><tbody>";
      for (var i = 0; i < output.length; i++){
        string = string + "<tr>";
        if (i == 0) {
          string = string + "<td><b>26-31</b></td>";
        } else if (i == 1) {
          string = string + "<td><b>15-25</b></td>";
        } else if (i == 2) {
          string = string + "<td><b>8-14</b></td>";
        } else if (i == 3){
          string = string + "<td><b>1-7</b></td>";
        }
        for (var j = 0; j < output[i].length; j++){
          if (bm[i][j]){
            if (spaces.includes(parseInt(j/5)) && j % 5 == 4){
              string = string + '<td style="background-color: #d3d3d3; border-right: solid black 1px;">' + output[i][j].toFixed(2) + "</td>";
            } else {
              string = string + '<td style="background-color: #d3d3d3;">' + output[i][j].toFixed(2) + "</td>";
            }
          } else {
            if (spaces.includes(parseInt(j/5)) && j % 5 == 4){
              string = string + '<td style="border-right: solid black 1px;">' + output[i][j].toFixed(2) + "</td>";
            } else {
              string = string + '<td>' + output[i][j].toFixed(2) + "</td>";
            }
          }
        }
        string = string + "</tr>";
      }
      string = string + "</tbody></table>";
      outputDisplay.innerHTML = string;
    }

    input.onkeyup = (e) => {
      e.preventDefault();
      if (e.keyCode == 13) {
        button.click();
      }
    }
  </script>
</html>
